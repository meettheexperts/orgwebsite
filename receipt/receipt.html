<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MTE Synergy Receipt Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @media print {
            #item-form,
            #amount-paid-sector,
            .btn-danger,
            .btn-secondary,
            #customer-fields,
            #main-heading,
            #doc-type-selector {
                display: none !important;
            }

            #items-table th:last-child,
            #items-table td:last-child {
                display: none !important;
            }

            body,
            .container {
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
            }

            .card,
            .card-body {
                box-shadow: none !important;
                border: none !important;
            }

            /* Center the entire receipt horizontally on print */
            body {
                display: flex !important;
                justify-content: center !important;
                align-items: flex-start !important;
                min-height: 100vh !important;
            }

            .container {
                width: 80% !important;
                max-width: 800px !important;
            }

            .row.g-2 {
                display: flex !important;
                justify-content: center !important;
                align-items: flex-start !important;
            }

            .col-md-7 {
                float: none !important;
                margin-left: auto !important;
                margin-right: auto !important;
                max-width: 100% !important;
                width: 100% !important;
                display: block !important;
            }

            .col-md-5 {
                display: none !important;
            }
        }
    </style>
</head>

<body class="bg-light py-3">
    <div class="container">
        <h2 class="text-center mb-3" id="main-heading" style="font-size:1.3rem;">MTE SYNERGY SMC LTD - Receipt
            Generator</h2>
        <div class="row g-2">
            <!-- Inputs -->
            <div class="col-md-5">
                <form id="customer-fields" class="row g-2 mb-2">
                    <div class="col-12">
                        <input type="text" id="customer-name" class="form-control form-control-sm"
                            placeholder="Customer Name" required />
                    </div>
                    <div class="col-12">
                        <input type="tel" id="customer-phone" class="form-control form-control-sm"
                            placeholder="Telephone Number" required />
                    </div>
                    <div class="col-12">
                        <input type="text" id="issued-by" class="form-control form-control-sm"
                            placeholder="Issued By (Staff Name)" required />
                    </div>
                </form>
                <form id="item-form" class="row g-2 mb-2">
                    <div class="col-6">
                        <input type="text" id="item-desc" class="form-control form-control-sm"
                            placeholder="Item Description" required />
                    </div>
                    <div class="col-4">
                        <input type="number" id="item-amount" class="form-control form-control-sm"
                            placeholder="Amount (UGX)" required />
                    </div>
                    <div class="col-2 d-grid">
                        <button type="submit" class="btn btn-primary btn-sm">Add</button>
                    </div>
                </form>
                <div class="mb-2" id="doc-type-selector">
                    <select id="doc-type" class="form-select form-select-sm w-auto d-inline-block">
                        <option value="Receipt">Receipt</option>
                        <option value="Invoice">Invoice</option>
                    </select>
                </div>
                <div class="mb-2" id="amount-paid-sector">
                    <label for="amount-paid" class="form-label mb-1">Amount Paid (UGX)</label>
                    <input type="number" id="amount-paid" class="form-control form-control-sm" value="0" />
                </div>
            </div>
            <!-- Preview -->
            <div class="col-md-7">
                <div class="card shadow-sm">
                    <div class="card-body p-3">
                        <div class="text-center mb-2" style="font-weight:bold; font-size:1.1rem;">
                            MTE SYNERGY SMC LTD<br>
                            <span style="font-size:0.95em;">Meet The Xperts â€“ Integrated Solutions for a Better Tomorrow
                            </span><br>
                            <span style="font-size:0.95em;">P.O Box 153572, Sonde, Mukono, Uganda</span><br>
                            <span style="font-size:0.95em;">Website: <a href="https://meetthexperts.com" target="_blank"
                                    style="color:#00796b;">meetthexperts.com</a></span><br>
                            <span style="font-size:0.95em;">Tel/WhatsApp: +256 777233322</span>
                        </div>
                        <div class="text-center mb-2" style="font-size:1.1em;font-weight:600;">
                            <span id="doc-type-display">Receipt</span>
                        </div>
                        <div class="mb-2 small">
                            <strong>Customer:</strong> <span id="preview-customer-name"></span><br>
                            <strong>Tel:</strong> <span id="preview-customer-phone"></span><br>
                            <strong>Date:</strong> <span id="receipt-date"></span><br>
                            <strong>Issued By:</strong> <span id="preview-issued-by"></span>
                        </div>
                        <table class="table table-sm table-bordered mb-2" id="items-table">
                            <thead class="table-light">
                                <tr>
                                    <th>Description</th>
                                    <th>Amount (UGX)</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div class="d-flex justify-content-between small">
                            <span>Subtotal:</span>
                            <span>UGX <span id="subtotal">0</span></span>
                        </div>
                        <div class="d-flex justify-content-between small">
                            <span>Balance Due:</span>
                            <span>UGX <span id="balance">0</span></span>
                        </div>
                        <div class="alert alert-warning mt-2 py-1 px-2 small" id="policy-note">
                            <strong>Policy:</strong> Services once offered or receipts once issued are not refundable or
                            exchangeable.
                        </div>
                        <button class="btn btn-secondary btn-sm mt-2" id="save-pdf-btn" type="button">Save as PDF</button>
                    </div>
                </div>
            </div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const form = document.getElementById('item-form');
                const descInput = document.getElementById('item-desc');
                const amountInput = document.getElementById('item-amount');
                const tableBody = document.querySelector('#items-table tbody');
                const subtotalEl = document.getElementById('subtotal');
                const amountPaidEl = document.getElementById('amount-paid');
                const balanceEl = document.getElementById('balance');
                const customerNameInput = document.getElementById('customer-name');
                const customerPhoneInput = document.getElementById('customer-phone');
                const issuedByInput = document.getElementById('issued-by');
                const previewCustomerName = document.getElementById('preview-customer-name');
                const previewCustomerPhone = document.getElementById('preview-customer-phone');
                const previewIssuedBy = document.getElementById('preview-issued-by');
                const receiptDate = document.getElementById('receipt-date');
                const docType = document.getElementById('doc-type');
                const docTypeDisplay = document.getElementById('doc-type-display');
                let items = [];

                function setTodayDate() {
                    const today = new Date();
                    const yyyy = today.getFullYear();
                    const mm = String(today.getMonth() + 1).padStart(2, '0');
                    const dd = String(today.getDate()).padStart(2, '0');
                    receiptDate.textContent = `${yyyy}-${mm}-${dd}`;
                }

                function updateCustomerPreview() {
                    previewCustomerName.textContent = customerNameInput.value;
                    previewCustomerPhone.textContent = customerPhoneInput.value;
                    previewIssuedBy.textContent = issuedByInput.value;
                }

                function updateDocType() {
                    docTypeDisplay.textContent = docType.value;
                }

                function updateTable() {
                    tableBody.innerHTML = '';
                    let subtotal = 0;
                    items.forEach((item, index) => {
                        subtotal += item.amount;
                        const row = `<tr>
            <td>${item.description}</td>
            <td>${item.amount.toLocaleString()}</td>
            <td><button class="btn btn-danger btn-sm" onclick="removeItem(${index})">Remove</button></td>
          </tr>`;
                        tableBody.innerHTML += row;
                    });
                    subtotalEl.textContent = subtotal.toLocaleString();
                    const paid = parseInt(amountPaidEl.value) || 0;
                    const balance = subtotal - paid;
                    balanceEl.textContent = balance.toLocaleString();
                }

                function updateAll() {
                    updateTable();
                    updateCustomerPreview();
                    updateDocType();
                }

                window.removeItem = function (index) {
                    items.splice(index, 1);
                    updateAll();
                };

                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    const desc = descInput.value.trim();
                    const amount = parseInt(amountInput.value);
                    if (desc && amount) {
                        items.push({ description: desc, amount });
                        descInput.value = '';
                        amountInput.value = '';
                        updateAll();
                    }
                });

                customerNameInput.addEventListener('input', updateAll);
                customerPhoneInput.addEventListener('input', updateAll);
                issuedByInput.addEventListener('input', updateAll);
                docType.addEventListener('change', updateAll);
                amountPaidEl.addEventListener('input', updateAll);

                // Save as PDF
                const savePdfBtn = document.getElementById('save-pdf-btn');
                const originalTitle = document.title;
                savePdfBtn.addEventListener('click', function () {
                    const name = customerNameInput.value.trim() || 'Receipt';
                    document.title = name.replace(/[\\/:*?"<>|]/g, '') + ' - MTE Synergy';
                    window.print();
                    setTimeout(() => { document.title = originalTitle; }, 1000);
                });

                setTodayDate();
                updateAll();
            });
        </script>
    </div>
</body>

</html>